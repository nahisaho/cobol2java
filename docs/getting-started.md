# COBOL2Java クイックスタート

**Version**: 1.2.0  
**Last Updated**: 2025-12-12

---

## 1. 前提条件

### 必要なツール

| ツール | バージョン | インストール |
|--------|-----------|-------------|
| Node.js | 20.x | [nvm](https://github.com/nvm-sh/nvm) または公式サイト |
| pnpm | 9.x | `npm install -g pnpm` |
| Git | 最新 | 公式サイト |

### オプション

| ツール | 用途 | インストール |
|--------|------|-------------|
| GnuCOBOL | COBOL実行検証 | `apt install gnucobol` |
| Java 17 | 生成コードの検証 | SDKMAN または公式サイト |

---

## 2. インストール

### 2.1 リポジトリのクローン

```bash
git clone https://github.com/nahisaho/cobol2java.git
cd cobol2java
```

### 2.2 依存関係のインストール

```bash
pnpm install
```

### 2.3 ビルド

```bash
pnpm build
```

### 2.4 テスト実行

```bash
pnpm test
```

期待される出力：

```
 ✓ packages/core/__tests__/transform.test.ts (101 tests)
 ✓ packages/core/__tests__/parser.test.ts (11 tests)
 ✓ packages/core/__tests__/generator.test.ts (8 tests)
 ✓ packages/core/__tests__/converter.test.ts (8 tests)

 Test Files  4 passed (4)
      Tests  128 passed (128)
```

---

## 3. 基本的な使い方

### 3.1 プログラムによる変換

```typescript
import { convert } from 'cobol2java-core';

const cobolSource = `
       IDENTIFICATION DIVISION.
       PROGRAM-ID. HELLO.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01 WS-NAME PIC X(20) VALUE "World".
       PROCEDURE DIVISION.
           DISPLAY "Hello, " WS-NAME.
           STOP RUN.
`;

const result = await convert(cobolSource, {
  packageName: 'com.example',
  javaVersion: 17,
});

console.log(result.java);
```

### 3.2 生成されるJavaコード

```java
package com.example;

/**
 * Converted from COBOL program: HELLO
 * Generated by COBOL2Java
 */
public class Hello {
    private String wsName = "World";

    public void procedureDivision() {
        System.out.println("Hello, " + wsName);
        System.exit(0);
    }

    public static void main(String[] args) {
        new Hello().procedureDivision();
    }
}
```

---

## 4. 変換オプション

### 4.1 利用可能なオプション

```typescript
interface ConversionOptions {
  // LLMプロバイダー（'openai' | 'claude' | 'ollama' | 'copilot' | 'none'）
  llmProvider?: LLMProvider;
  
  // LLMモデル名
  llmModel?: string;
  
  // LLMAPIキー
  llmApiKey?: string;
  
  // Spring Boot互換コード生成
  springBoot?: boolean;
  
  // ユニットテスト生成
  generateTests?: boolean;
  
  // ターゲットJavaパッケージ名
  packageName?: string;
  
  // ターゲットJavaバージョン（11 | 17 | 21）
  javaVersion?: 11 | 17 | 21;
  
  // 厳格モード（警告でも失敗）
  strict?: boolean;
}
```

### 4.2 オプション使用例

```typescript
// 基本変換
const result1 = await convert(cobolSource);

// LLM補助変換（OpenAI）
const result2 = await convert(cobolSource, {
  llmProvider: 'openai',
  llmApiKey: process.env.OPENAI_API_KEY,
});

// Spring Boot用コード生成
const result3 = await convert(cobolSource, {
  springBoot: true,
  packageName: 'com.mycompany.legacy',
  javaVersion: 17,
});

// ローカルLLM使用（オフライン）
const result4 = await convert(cobolSource, {
  llmProvider: 'ollama',
  llmModel: 'codellama',
});
```

---

## 5. 対応COBOL構文

### 5.1 基本ステートメント

| COBOL | Java | 対応状況 |
|-------|------|---------|
| `MOVE A TO B` | `b = a;` | ✅ |
| `COMPUTE X = A + B` | `x = a.add(b);` | ✅ |
| `DISPLAY "Hello"` | `System.out.println("Hello");` | ✅ |
| `ACCEPT X` | `x = scanner.nextLine();` | ✅ |
| `STOP RUN` | `System.exit(0);` | ✅ |

### 5.2 制御構造

| COBOL | Java | 対応状況 |
|-------|------|---------|
| `IF...ELSE...END-IF` | `if...else` | ✅ |
| `EVALUATE...WHEN` | `switch` | ✅ |
| `PERFORM...UNTIL` | `while` | ✅ |
| `PERFORM...TIMES` | `for` | ✅ |
| `GO TO` | `// goto label` | ⚠️ |

### 5.3 データ定義

| COBOL | Java | 対応状況 |
|-------|------|---------|
| `PIC X(n)` | `String` | ✅ |
| `PIC 9(n)` | `int` / `long` | ✅ |
| `PIC S9(n)V9(m)` | `BigDecimal` | ✅ |
| `COMP` / `BINARY` | `int` / `long` | ✅ |
| `COMP-3` | `BigDecimal` | ✅ |
| `OCCURS n TIMES` | `[]` 配列 | ✅ |
| `REDEFINES` | 別フィールド | ✅ |
| `88-level` | boolean条件 | ✅ |

### 5.4 組込み関数

| カテゴリ | 関数例 | 対応状況 |
|---------|--------|---------|
| 文字列 | LENGTH, TRIM, UPPER-CASE | ✅ |
| 数値 | ABS, SQRT, MOD, REM | ✅ |
| 日付 | CURRENT-DATE, INTEGER-OF-DATE | ✅ |
| Unicode | ULENGTH, UPOS, USUBSTR | ✅ |

---

## 6. エラー処理

### 6.1 変換結果の確認

```typescript
const result = await convert(cobolSource);

// エラーチェック
if (result.errors.length > 0) {
  console.error('Conversion errors:');
  for (const error of result.errors) {
    console.error(`  Line ${error.line}: ${error.message}`);
  }
}

// 警告チェック
if (result.warnings.length > 0) {
  console.warn('Conversion warnings:');
  for (const warning of result.warnings) {
    console.warn(`  Line ${warning.line}: ${warning.message}`);
  }
}

// 変換成功
console.log(result.java);
```

### 6.2 一般的なエラーと対処法

| エラー | 原因 | 対処法 |
|-------|------|--------|
| `PARSE_ERROR` | COBOL構文エラー | ソースコードの構文を確認 |
| `UNSUPPORTED_SYNTAX` | 未対応構文 | 手動変換または対応待ち |
| `TYPE_MISMATCH` | データ型不一致 | PIC句を確認 |
| `LLM_ERROR` | LLM呼び出し失敗 | APIキー・ネットワーク確認 |

---

## 7. プロジェクト構成

### 7.1 ディレクトリ構造

```
cobol2java/
├── packages/
│   ├── core/          # コア変換ライブラリ
│   ├── cli/           # CLIツール（将来）
│   └── web/           # Webインターフェース（将来）
├── docs/              # ドキュメント
├── steering/          # プロジェクト運営
└── storage/           # 仕様書・変更履歴
```

### 7.2 開発コマンド

```bash
# テスト実行
pnpm test

# テスト（ウォッチモード）
pnpm test:watch

# ビルド
pnpm build

# リント
pnpm lint

# フォーマット
pnpm format
```

---

## 8. トラブルシューティング

### 8.1 よくある問題

#### pnpm install が失敗する

```bash
# Node.jsバージョン確認
node --version  # v20.x 必要

# pnpmバージョン確認
pnpm --version  # v9.x 推奨

# キャッシュクリア
pnpm store prune
pnpm install
```

#### テストが失敗する

```bash
# クリーンビルド
pnpm clean
pnpm install
pnpm build
pnpm test
```

#### LLM変換が動作しない

```bash
# 環境変数確認
echo $OPENAI_API_KEY

# .envファイル作成
echo "OPENAI_API_KEY=sk-..." > .env
```

### 8.2 サポート

- [GitHub Issues](https://github.com/nahisaho/cobol2java/issues)
- [Discussions](https://github.com/nahisaho/cobol2java/discussions)

---

## 参考リンク

- [コンセプト](./concept.md)
- [アーキテクチャ](./architecture.md)
- [GitHub Repository](https://github.com/nahisaho/cobol2java)
